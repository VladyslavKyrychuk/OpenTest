<?php
/************************************************************************/
/* OpenTEST System: The System Of Computer Testing Knowleges            */
/* ============================================                         */
/*                                                                      */
/* Copyright (c) 2002-2005 by OpenTEST Team                             */
/* http://opentest.com.ua                                               */
/* e-mail: opentest@opentest.com.ua                                     */
/*                                                                      */
/************************************************************************/
/* 25/11/2004 22:32:01								                    */
/************************************************************************/
if (INDEXPHP != 1) {
    die("You can't access this file directly...");
}

// Параметри підключення до бази даних
$mysqli = new mysqli($config['mysql_host'], $config['mysql_user'], $config['mysql_password'], $config['mysql_dbname']);

// Перевірка на помилки при підключенні
if ($mysqli->connect_error) {
    die("Connection failed: " . $mysqli->connect_error);
}

// Встановлюємо кодування
$mysqli->set_charset("utf8");

function sql_query($sql) {
    global $mysqli, $config, $db_query_count;
    if ($config['debug_query']) {
        echo "<font class=\"debug\">SQL query: " . htmlspecialchars(str_replace(",", ", ", $sql)) . "</font><br>";
    }
    // Виконання SQL запиту
    $result = $mysqli->query($sql);
    if (!$result) {
        die("SQL error: " . $mysqli->error);
    }
    $db_query_count++;
    return $result;
}

function sql_single_query($sql) {
    global $mysqli, $config, $db_query_count;
    if ($config['debug_query']) {
        echo "<font class=\"debug\">SQL query: " . htmlspecialchars(str_replace(",", ", ", $sql)) . "</font><br>";
    }
    // Виконання SQL запиту
    $result = $mysqli->query($sql);
    if (!$result) {
        die("SQL error: " . $mysqli->error);
    }
    // Перевірка на кількість рядків
    if ($result->num_rows != 1) {
        echo _DB3;
    }
    $row = $result->fetch_array(MYSQLI_ASSOC);
    $db_query_count++;
    return $row;
}

// Закриваємо з'єднання з базою даних при завершенні скрипта
register_shutdown_function(function() use ($mysqli) {
    $mysqli->close();
});
?>
