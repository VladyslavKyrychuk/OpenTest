<?
if (INDEXPHP!=1) die ('You can\'t access this file directly...');
themeleftbox('Системные требования', '', '', true);
echo '<tr><td>';

$errors=check_server();

if (count($errors)==0){
	echo "<p style='font-size:14px;color:green;font-weight:bold;'>Конфигурация Вашего сервера соответствует требованиям OpenTEST2. Нажмите кнопку ниже для продолжения.</p>
	<form action='index.php?page=install_db' method=post>
	<input type=submit value='            Continue            '>
	</form>";
} else {
	echo "<p style='font-size:14px;color:red;font-weight:bold;'>Измените конфигурацию Вашего сервера для установки OpenTETS2.</p>
	<br> Please fix the following errors:";
	foreach($errors as $error) echo "<br><dd style='color:red;'>$error</dd>";
}

function check_server(){	
	$icon_ok="<img align=absmiddle src='themes/opentest2/images/approve.gif'>";
	$icon_failed="<img  align=absmiddle src='themes/opentest2/images/not_approve.gif'>";
	$icon_warn ="<img align=absmiddle  src='themes/opentest2/images/yellowcaution.gif'>";

	$errors=array();

	// check php
	if (version_compare(PHP_VERSION,'4','>=')) echo "<p>$icon_ok PHP: ".PHP_VERSION." OK .</p>";
	else {
		echo "<p>$icon_failed PHP: ".PHP_VERSION." FAILED .</p>";
		$errors[]='PHP version is not supported';
	}

	$path_trans = @$_SERVER['PATH_TRANSLATED'];
	$path_trans_display = $path_trans;
	if (empty($path_trans)){
	    	$path_trans_display = $_SERVER['SCRIPT_FILENAME'] . '(SCRIPT_FILENAME)';
	    	$path_trans = $_SERVER['SCRIPT_FILENAME'];
	}

	echo "<p>$icon_ok Path_Translated: ".$path_trans_display."</p>";
	$real_path = realpath(dirname(basename($_SERVER['PHP_SELF'])));
	echo "<p>$icon_ok Real Path: ".$real_path."</p>";
	$register_globals = ini_get("register_globals");
	if (($register_globals) AND ( $register_globals!= 'off'))
	{
		echo "<p>$icon_failed Register Globals: On (Non-secure, please disable in php.ini)</p>";
		$errors[]='Register Globals: On. Non-secure, please disable in php.ini';
	}
	else echo "<p>$icon_ok Register Globals: Off (Recommended)</p>";
	
	// check htaccess support
	if(ini_get("default_charset")=="utf-8") echo "<p>$icon_ok HTACCESS support: On (Recommended) </p>";
	else echo "<p>$icon_warn HTACCESS support: Off (please, enable for better secutity) </p>";

	// SAFE MODE check
	if(ini_get("safe_mode")){
		echo "<p>$icon_failed PHP Safe mode: On  FAILED (disable safe mode in php.ini) </p>";
		$errors[]='PHP Safe mode: On  FAILED (disable safe mode in php.ini)';
	} else echo "<p>$icon_ok Safe mode: Off  OK</p>";
	
	//Check for upload support built in to PHP
	if(@ini_get("file_uploads")){
		echo "<p>$icon_ok PHP Upload Support: On  </p>";
		echo "<p>$icon_ok PHP TMP dir :".ini_get("upload_tmp_dir")."</p>";
	} else {
		echo "<p>$icon_failed PHP Upload Support: Off  FAILED (please enable in phh.ini)</p>";
		$errors[]="PHP Upload Support: Off  FAILED (please enable in phh.ini)";
	}

	// check  directories permissions
	echo "<p>File permissions</p>";
	if(@is_writable("tmp"))	echo "<p>$icon_ok /tmp: writable  </p>";
	else {echo "<p>$icon_failed /tmp: isn't writable  </p>";
		$errors[]="/tmp: isn't writable";
	}

	if(@is_writable("media"))	echo "<p>$icon_ok /media: writable  </p>";
	else {
		echo "<p>$icon_failed /media: isn't writable  </p>";
		$errors[]="/media: isn't writable";
	}
		
	if(@is_writable("include/config.php")) echo "<p>$icon_ok /include/config.php: writable  </p>";
	else {
		echo "<p>$icon_failed /include/config.php: isn't writable  </p>";
		$errors[]="/include/config.php: isn't writable";
	}

	if(@is_writable("modules/tests/include/tmp")) echo "<p>$icon_ok /modules/tests/include/tmp: writable  </p>";
	else {
		echo "<p>$icon_failed /modules/tests/include/tmp: isn't writable  </p>";
		$errors[]="/modules/tests/include/tmp: isn't writable";
	}

	if(@is_writable("modules/tests/include/xmls")) echo "<p>$icon_ok /modules/tests/include/xmls: writable  </p>";
	else {
		echo "<p>$icon_failed /modules/tests/include/xmls: isn't writable  </p>";
		$errors[]="/modules/tests/include/xmls: isn't writable";
	}

	$php_extensions = get_loaded_extensions();
	
	// check iconv
	if (in_array("iconv",$php_extensions)) echo "<p>$icon_ok ICONV: OK</p>";
	else {
		echo "<p>$icon_failed ICONV: FAILED</p>";
		$errors[]="PHP ICONV library is not installed";
	}
	
	// check GD
	if (in_array("gd",$php_extensions)) echo "<p>$icon_ok GD: OK</p>";
	else {
		echo "<p>$icon_failed GD: FAILED</p>";
		$errors[]="PHP GD library is not installed";
	}

	// check DOM
	if (in_array("dom",$php_extensions) or in_array("domxml",$php_extensions)) echo "<p>$icon_ok DOM: OK</p>";
	else {
		echo "<p>$icon_failed DOM: FAILED</p>";
		$errors[]="PHP DOM (DOMXML) library is not installed";
	}
	
	// check XSL
	if (in_array("xslt",$php_extensions) or in_array("xsl",$php_extensions)) echo "<p>$icon_ok XSL: OK</p>";
	else {
		echo "<p>$icon_failed XSL: FAILED</p>";
		$errors[]="PHP XSL (XSLT) library is not installed";
	}

	// check mbstring
	if (in_array("mbstring",$php_extensions)) echo "<p>$icon_ok MBSTRING: OK</p>";
	else {
		echo "<p>$icon_failed MBSTRING: FAILED</p>";
		$errors[]="PHP MBSTRING library is not installed";
	}

	// check zip
	if (in_array("zip",$php_extensions)) echo "<p>$icon_ok ZIP: OK</p>";
	else {
		echo "<p>$icon_failed ZIP: FAILED</p>";
		$errors[]="PHP ZIP library is not installed";
	}		
	
	// check zlib
	if (in_array("zlib",$php_extensions)) echo "<p>$icon_ok ZLIB: OK</p>";
	else {
		echo "<p>$icon_failed ZLIB: FAILED</p>";
		$errors[]="PHP ZLIB library is not installed";
	}

	// check libraries
	$data='';
	$data .= 'All PHP Extensions compiled: ';
	foreach($php_extensions as $module) $data .= $module.', ';
	$data = substr($data, 0, -2); // remove trailing comma
	$data .= "<br><br><br>";
	echo "$data";
	?>
	<h3>Платная поддержка частных и корпоративных пользователей</h3>
Создатель программы тестирования OpenTEST2 предоставляет на коммерческой основе поддержку пользователей OpenTEST2.<br>
<ul>
<li>Установка и настройка</li>
<li>Брендирование</li>
<li>Изменение программы</li>
<li>Администрирование и поддержка</li>
<li>Обучение персонала</li>
<li>Консультации</li>
</ul>

Говорить о какой-либо платности самого дистрибутива конечно же не надо. <br>OpenTEST2 — открытая и бесплатная программа, такой она пока и останется, не смотря на появившуюся платную поддержку.
	<br><br>
	<b>Заказать платную поддержку:</b> premium@opentest.com.ua <br>
	<?
	return $errors;
}