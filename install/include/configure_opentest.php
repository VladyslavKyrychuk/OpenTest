<?
if (INDEXPHP!=1) die ("You can't access this file directly...");
@$action=$_REQUEST['action'];
@$database_host=$_POST['database_host'];
@$database_username=$_POST['database_username'];
@$database_password=$_POST['database_password'];
@$database_name=$_POST['database_name'];
@$database_created=$_POST['database_created'];

echo "<tr><td>";

switch($action){
	case "save":
		{
		$config_file=join("",file("include/config.php"));	
		$config_file=preg_replace("/(config\['opentest_root_path'\]\W*=\W*)'(.)*'/","$1 '".$_POST['opentest_root_path']."'",$config_file);
		$config_file=preg_replace("/(config\['additional_path'\]\W*=\W*)'(.)*'/","$1 '".addslashes($_POST['additional_path'])."'",$config_file);
		$config_file=preg_replace("/(config\['opentest_server_url'\]\W*=\W*)'(.)*'/","$1 '".$_POST['opentest_root_url']."'",$config_file);
		$config_file=preg_replace("/(config\['mysql_host'\]\W*=\W*)'(.)*'/","$1 '".$_POST['database_host']."'",$config_file);
		$config_file=preg_replace("/(config\['mysql_user'\]\W*=\W*)'(.)*'/","$1 '".$_POST['database_username']."'",$config_file);
		$config_file=preg_replace("/(config\['mysql_password'\]\W*=\W*)'(.)*'/","$1 '".$_POST['database_password']."'",$config_file);
		$config_file=preg_replace("/(config\['mysql_dbname'\]\W*=\W*)'(.)*'/","$1 '".$_POST['database_name']."'",$config_file);
		$config_file=preg_replace("/(config\['strong_hash'\]\W*=\W*)(.)*/","$1 ".$_POST['strong_hash'].";",$config_file);
		$config_file=preg_replace("/(config\['allow_attempts'\]\W*=\W*)(.)*/","$1 ".$_POST['allow_attempts'].";",$config_file);
		$config_file=preg_replace("/(config\['allow_interval'\]\W*=\W*)(.)*/","$1 ".$_POST['allow_interval'].";",$config_file);
		$config_file=preg_replace("/(config\['opentest_installed'\]\W*=\W*)(.)*/","$1 1;",$config_file);

		$f_config=fopen("include/config.php","w+");
		if (fwrite($f_config,$config_file)) {
echo "<p style='color:green;'>Файл конфигарии успешно обновлён.</p>
<p>
<h3>Поздравляем! OpenTETS2 был успешно установлен на этот  компьютер.</h3>
</p>

<p> Для первого входа  в систему используйте указаныый ниже аккаунт:</p>

Login: <b>opentest</b>  <br>
password: <b>opentest</b>
<br><br>

Этот аккаунт обладает всеми правами. <br>
Обязательно измените пароль после первого входа!. <br><br>

В БД уже есть несколько тестов для примера.

Если Вам нужна помощь, обращайтесь по адресу (<a href=email:nserv@opentest.com.ua>opentest@opentest.com.ua</a>).

<p style='font-size:14;font-weight:bold;'> <a href='index.php'>Нажмите здесь для перехода на главную страницу пргграммы тестирования знаний OpenTETS2</a></p>

<p style='color:red;'>Для начала работы с программой удалите папку 'install' !!!</p>";
		}
		else {
			echo "<p style='color:red;'>Файл конфигарии не обновлён. Перепроверьте параментры.</p>";
			draw_configure_form();	
		}
		break;	
	}
	default:
		draw_configure_form();
}

function draw_configure_form(){
	global $database_host,$database_username,$database_password,$database_name;

	$opentest_root_path = realpath(dirname(basename($_SERVER['PHP_SELF'])));
	$additional_path=dirname($_SERVER['REQUEST_URI']);
	$additional_path = str_replace('\\','/',$additional_path);
	if ($additional_path=='/') $additional_path='';
	$opentest_root_url="http://".$_SERVER['HTTP_HOST'];

	echo "<p>Это основные параметры OpenTETS2. Проверьте их и, если нужно, измените.</p>
<form method=post>
<input type=hidden name='action' value='save'>
	<table >
		<tr>
			<td colspan=2 style='font-weight:bold;'>System configuration:<hr></td>
		</tr>
		<tr>
			<td>Physical path to OpenTETS root folder</td>
			<td><input style='width:300;' type=text name='opentest_root_path' value='$opentest_root_path'></td>
		</tr>
		<tr>
			<td>Additional path from DOCUMENT ROT</td>
			<td><input style='width:300;' type=text name='additional_path' value='$additional_path'></td>
		</tr>
		<tr>
			<td>HTTP HOST (or domain name)</td>
			<td><input style='width:300;' type=text name='opentest_root_url' value='$opentest_root_url'></td>
		</tr>
		<tr>
			<td colspan=2 style='font-weight:bold;'>Database configuration:<hr></td>
		</tr>
		<tr>
			<td>Database Host</td>
			<td><input style='width:300;' type=text name='database_host' value='$database_host'></td>
		</tr>
		<tr>
			<td>Database Username</td>
			<td><input style='width:300;' type=text name='database_username' value='$database_username'></td>
		</tr>
		<tr>
			<td>Database Password</td>
			<td><input style='width:300;' type=text name='database_password' value='$database_password'></td>
		</tr>
		<tr>
			<td>Database Name</td>
			<td><input style='width:300;' type=text name='database_name' value='$database_name'></td>
		</tr>
		<tr>
			<td colspan=2 style='font-weight:bold;'>Authentification options:<hr></td>
		</tr>
		<tr>
			<td>Authentification method</td>
			<td>
				<input type=radio name='strong_hash' value='1' id='created_radio1' >
				<label for='created_radio1'> Standard (stable work even on slow connection) </label><br>
				<input type=radio name='strong_hash' value='0' id='created_radio2' checked>
				<label for='created_radio2'> Advanced (for best security)</label>
			</td>
		</tr>
		<tr>
			<td>Bruteforce protection</td>
			<td>Max of <input style='width:30;' type=text name='allow_attempts' value='5'> login attampts during 
				<input style='width:50;' type=text name='allow_interval' value='100'> seconds
			</td>
		</tr>
	</table>
<input type=submit value='   Сохранить настройки    '>
</form>";
}
?>
<h3>Платная поддержка частных и корпоративных пользователей</h3>
Создатель программы тестирования OpenTEST2 предоставляет на коммерческой основе поддержку пользователей OpenTEST2.<br>
<ul>
<li>Установка и настройка</li>
<li>Брендирование</li>
<li>Изменение программы</li>
<li>Администрирование и поддержка</li>
<li>Обучение персонала</li>
<li>Консультации</li>
</ul>

Говорить о какой-либо платности самого дистрибутива конечно же не надо. <br>OpenTEST2 — открытая и бесплатная программа, такой она пока и останется, не смотря на появившуюся платную поддержку.
	<br><br>
	<b>Заказать платную поддержку:</b> premium@opentest.com.ua <br>
<?